<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Words War</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: monospace;
    box-sizing: border-box;
    background: white;
  }

  body {
    display: grid;
    grid-template-columns: 2.5% 20% 2.5% 50% 2.5% 20% 2.5%;
    grid-template-rows: auto 50vh auto auto auto 1fr;
    height: 100vh;
  }

  h2 {
    grid-column: 1 / 8;
    margin: 0;
    padding: 10px 0;
    text-align: center;
  }

  #left-panel {
    grid-column: 2 / 3;
    grid-row: 2;
    border: 1px solid #000;
    padding: 10px;
    box-sizing: border-box;
    overflow-y: auto;
    height: 100%;
  }

  #stage {
    grid-column: 4 / 5;
    grid-row: 2;
    border: 1px solid #000;
    padding: 10px;
    box-sizing: border-box;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  #right-panel {
    grid-column: 6 / 7;
    grid-row: 2;
    border: 1px solid #000;
    padding: 10px;
    box-sizing: border-box;
    overflow-y: auto;
    height: 100%;
  }

  #panel {
    width: 100%;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .team {
    display: flex;
    justify-content: center;
    gap: 20px;
  }

  .letter-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }

  .letter {
    width: 60px;
    height: 60px;
    font-size: 36px;
    line-height: 60px;
    text-align: center;
    user-select: none;
    transition: opacity 0.3s;
  }

  .dead {
    opacity: 0.1;
  }

  .hp-bar {
    width: 60px;
    height: 8px;
    border: 1px solid black;
    background-color: #ddd;
    margin-top: 4px;
    position: relative;
    overflow: hidden;
    box-sizing: border-box;
  }

  .hp-fill {
    height: 100%;
    background-color: #4caf50;
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
    transition: width 0.3s ease;
  }

  .attacker-clone {
    position: absolute;
    z-index: 100;
    width: 60px;
    height: 60px;
    font-size: 36px;
    line-height: 60px;
    text-align: center;
    pointer-events: none;
  }

  #result {
    grid-column: 2 / 7;
    grid-row: 3;
    height: 24px;
    font-weight: bold;
    text-align: center;
    margin: 10px 0;
  }

  #word-input {
    grid-column: 2 / 7;
    grid-row: 4;
    font-family: monospace;
    font-size: 16px;
    padding: 4px;
    width: 200px;
    margin: 0 auto;
    display: block;
    text-transform: uppercase;
    text-align: center;
  }

  #fight-button {
    grid-column: 2 / 7;
    grid-row: 5;
    padding: 8px 16px;
    font-family: monospace;
    font-size: 16px;
    cursor: pointer;
    margin: 10px auto 0;
    display: block;
  }

  #fight-button:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }

  @keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    50% { transform: translateX(4px); }
    75% { transform: translateX(-4px); }
    100% { transform: translateX(0); }
  }

  .shake {
    animation: shake 0.2s;
  }

  .panel-title {
    font-weight: bold;
    margin-bottom: 10px;
  }

  ul {
    padding-left: 20px;
    margin: 0;
    max-height: 80vh;
    overflow-y: auto;
  }
</style>
</head>
<body>

  <h2>Words War</h2>

  <div id="left-panel">
    <div class="panel-title">Your Words</div>
    <ul id="word-history"></ul>
  </div>

  <div id="stage">
    <div id="panel">
      <div id="ai" class="team"></div>
      <div id="player" class="team"></div>
    </div>
  </div>

  <div id="right-panel">
    <div class="panel-title">Enemy</div>
    <ul id="enemy-info"></ul>
  </div>

  <div id="result">Enter a word that matches the length</div>

  <input type="text" id="word-input" placeholder="Type your word" disabled />

  <button id="fight-button" disabled>Fight</button>

<div id="stats-display" class="panel-title" style="grid-column: 2 / 7; grid-row: 6; text-align: center; padding: 10px 0; font-size: 14px; white-space: pre-wrap;"></div>

<script>
  const aiTeam = document.getElementById("ai");
  const playerTeam = document.getElementById("player");
  const resultEl = document.getElementById("result");
  const input = document.getElementById("word-input");
  const fightBtn = document.getElementById("fight-button");
  const aiHistoryEl = document.getElementById("enemy-info");
  const playerHistoryEl = document.getElementById("word-history");

  const usedWords = new Set();

  async function fetchValidWord(min = 3, max = 5) {
    while (true) {
      const length = Math.floor(Math.random() * (max - min + 1)) + min;
      try {
        const response = await fetch(`https://api.datamuse.com/words?sp=${'?'.repeat(length)}&max=1000`);
        const words = await response.json();
        const filtered = words.filter(w =>
          (!w.tags || !w.tags.includes('abbr')) &&
          /^[a-z]+$/.test(w.word) &&
          !usedWords.has(w.word.toUpperCase())
        );
        if (filtered.length === 0) continue;
        const chosen = filtered[Math.floor(Math.random() * filtered.length)];
        if (chosen.word.length === length && !usedWords.has(chosen.word.toUpperCase())) {
          return chosen.word.toUpperCase();
        }
      } catch (e) {
        return generateRandomWord(min, max);
      }
    }
  }

  function generateRandomWord(min = 3, max = 5) {
    const length = Math.floor(Math.random() * (max - min + 1)) + min;
    return Array.from({ length }, () =>
      String.fromCharCode(65 + Math.floor(Math.random() * 26))
    ).join('');
  }

  function createLetterWithHP(letter) {
    const container = document.createElement("div");
    container.className = "letter-container";

    const letterDiv = document.createElement("div");
    letterDiv.className = "letter";
    letterDiv.textContent = letter;

    const hpBar = document.createElement("div");
    hpBar.className = "hp-bar";

    const hpFill = document.createElement("div");
    hpFill.className = "hp-fill";
    hpFill.style.width = "100%"; // full hp initially

    hpBar.appendChild(hpFill);
    container.appendChild(letterDiv);
    container.appendChild(hpBar);

    return container;
  }
  
	const letterStats = {
	  A: { hp: 95, damage: 22 },
	  B: { hp: 87, damage: 47 },
	  C: { hp: 99, damage: 30 },
	  D: { hp: 91, damage: 24 },
	  E: { hp: 99, damage: 33 },
	  F: { hp: 86, damage: 41 },
	  G: { hp: 92, damage: 36 },
	  H: { hp: 93, damage: 25 },
	  I: { hp: 89, damage: 44 },
	  J: { hp: 83, damage: 50 },
	  K: { hp: 90, damage: 27 },
	  L: { hp: 97, damage: 32 },
	  M: { hp: 85, damage: 26 },
	  N: { hp: 96, damage: 39 },
	  O: { hp: 94, damage: 35 },
	  P: { hp: 88, damage: 29 },
	  Q: { hp: 80, damage: 48 },
	  R: { hp: 99, damage: 31 },
	  S: { hp: 98, damage: 28 },
	  T: { hp: 84, damage: 45 },
	  U: { hp: 99, damage: 34 },
	  V: { hp: 87, damage: 40 },
	  W: { hp: 82, damage: 42 },
	  X: { hp: 90, damage: 38 },
	  Y: { hp: 95, damage: 43 },
	  Z: { hp: 88, damage: 37 }
	};

	function getLetterStats(letter) {
	  return letterStats[letter];
	}

	function renderLetterStats() {
	  const container = document.getElementById("stats-display");
	  const entries = Object.entries(letterStats);
	  let output = "";
	  
	  for (let i = 0; i < entries.length; i++) {
		const [letter, stats] = entries[i];
		output += `${letter} = HP:${stats.hp}, DMG:${stats.damage}   `;
		
		if ((i + 1) % 5 === 0) {
		  output += "\n";  // New line after every 5 items
		}
	  }
	  
	  container.textContent = output.trim();
	}


	renderLetterStats();

  

  function sanitizeInput(str) {
    return str.toUpperCase().replace(/[^A-Z]/g, "");
  }

  function getAliveLetters(teamEl) {
    return Array.from(teamEl.children).filter(l => !l.querySelector(".letter").classList.contains("dead"));
  }

  function addWordToHistory(listEl, word) {
    const li = document.createElement("li");
    li.textContent = word;
    listEl.appendChild(li);
  }

  function killLetter(letterContainer) {
    const letterEl = letterContainer.querySelector(".letter");
    letterEl.classList.add("dead");
    const hpFill = letterContainer.querySelector(".hp-fill");
    hpFill.style.width = "0%";
  }

  function shakeElement(el, type) {
    el.classList.add("shake");
    el.style.animationDuration = type === "miss" ? "0.1s" : "0.2s";
    setTimeout(() => {
      el.classList.remove("shake");
      el.style.animationDuration = "";
    }, type === "miss" ? 100 : 200);
  }

  

function getAliveLetters(teamEl) {
  return Array.from(teamEl.querySelectorAll(".letter-container")).map(container => {
    const letter = container.querySelector(".letter");
    return letter.classList.contains("dead") ? null : letter;
  }).filter(Boolean);
}

function animateAttack(attackerEl, defenderEl, callback) {
  const aRect = attackerEl.getBoundingClientRect();
  const dRect = defenderEl.getBoundingClientRect();
  const dx = dRect.left - aRect.left;
  const dy = dRect.top - aRect.top;
  const originalTransform = attackerEl.style.transform || "";
  let duration = 200;
  let start = null;

  function moveForward(timestamp) {
    if (!start) start = timestamp;
    const progress = Math.min((timestamp - start) / duration, 1);
    attackerEl.style.transform = `translate(${dx * progress}px, ${dy * progress}px)`;
    if (progress < 1) {
      requestAnimationFrame(moveForward);
    } else {
      const hit = true;

      if (hit) {
        const damage = parseInt(attackerEl.dataset.damage, 10);
        let defenderHP = parseInt(defenderEl.dataset.hp, 10) - damage;
        defenderHP = Math.max(defenderHP, 0);
        defenderEl.dataset.hp = defenderHP;

        const hpFill = defenderEl.parentElement.querySelector(".hp-fill");
        if (hpFill) {
			const maxHp = parseInt(defenderEl.dataset.maxHp, 10);
			hpFill.style.width = (defenderHP / maxHp) * 100 + '%';

        }

        if (defenderHP === 0) {
          killLetter(defenderEl.parentElement);
        }

        shakeElement(defenderEl.parentElement, "hit");
      }

      setTimeout(() => {
        start = null;
        requestAnimationFrame(function moveBack(timestamp) {
          if (!start) start = timestamp;
          const backProgress = Math.min((timestamp - start) / duration, 1);
          attackerEl.style.transform = `translate(${dx * (1 - backProgress)}px, ${dy * (1 - backProgress)}px)`;
          if (backProgress < 1) {
            requestAnimationFrame(moveBack);
          } else {
            attackerEl.style.transform = originalTransform;
            callback(hit);
          }
        });
      }, 200);
    }
  }
  requestAnimationFrame(moveForward);
}

function createTeamFromWord(teamEl, word) {
  teamEl.innerHTML = "";
  for (const ch of word) {
    const container = document.createElement("div");
    container.className = "letter-container";

    const letter = document.createElement("div");
    letter.className = "letter";
    letter.textContent = ch;

    const stats = getLetterStats(ch);
    letter.dataset.hp = stats.hp;
    letter.dataset.maxHp = stats.hp;
    letter.dataset.damage = stats.damage;

    const hpBar = document.createElement("div");
    hpBar.className = "hp-bar";

    const hpFill = document.createElement("div");
    hpFill.className = "hp-fill";
    hpFill.style.width = "100%";

    hpBar.appendChild(hpFill);
    container.appendChild(letter);
    container.appendChild(hpBar);
    teamEl.appendChild(container);
  }
}




  function fightLoop(attackerTeam, defenderTeam, onDone) {
    const attackers = getAliveLetters(attackerTeam);
    const defenders = getAliveLetters(defenderTeam);
    if (attackers.length === 0 || defenders.length === 0) {
      onDone();
      return;
    }
    const attacker = attackers[Math.floor(Math.random() * attackers.length)];
    const defender = defenders[Math.floor(Math.random() * defenders.length)];
    animateAttack(attacker, defender, (hit) => {
      if (getAliveLetters(defenderTeam).length === 0) return onDone();
      setTimeout(() => {
        fightLoop(defenderTeam, attackerTeam, onDone);
      }, 300);
    });
  }

  function resetStage(aiWord, playerWord) {
    createTeamFromWord(aiTeam, aiWord);
    createTeamFromWord(playerTeam, playerWord);
  }

  let currentAIWord = "";
  let currentPlayerWord = "";

  async function startNewRound() {
    resultEl.textContent = "Loading AI word...";
    input.disabled = true;
    fightBtn.disabled = true;
    currentAIWord = await fetchValidWord(3, 5);
    usedWords.add(currentAIWord);
    addWordToHistory(aiHistoryEl, currentAIWord);
    resetStage(currentAIWord, "");
    input.disabled = false;
    input.value = "";
    input.setAttribute("maxlength", currentAIWord.length);
    input.placeholder = `Type a word`;
    resultEl.textContent = `Enter a word that matches the length 0/${currentAIWord.length}`;
    fightBtn.disabled = true;
  }

  startNewRound();

  input.addEventListener("input", async () => {
    input.value = sanitizeInput(input.value);
    const currentLength = input.value.length;
    const maxLength = currentAIWord.length;
    if (currentLength === maxLength) {
      if (usedWords.has(input.value)) {
        resultEl.textContent = `Word already used! Try another. (${currentLength}/${maxLength})`;
        fightBtn.disabled = true;
        return;
      }
      resultEl.textContent = `Ready to fight! (${currentLength}/${maxLength})`;
      fightBtn.disabled = false;
    } else {
      resultEl.textContent = `Enter a word that matches the length ${currentLength}/${maxLength}`;
      fightBtn.disabled = true;
    }
  });

  fightBtn.addEventListener("click", () => {
  currentPlayerWord = input.value;
  usedWords.add(currentPlayerWord);
  addWordToHistory(playerHistoryEl, currentPlayerWord);
  resetStage(currentAIWord, currentPlayerWord);
  input.disabled = true;
  fightBtn.disabled = true;
  resultEl.textContent = "Fight started!";

  const firstAttacker = Math.random() < 0.5 ? playerTeam : aiTeam;
  const firstDefender = firstAttacker === playerTeam ? aiTeam : playerTeam;

  fightLoop(firstAttacker, firstDefender, () => {
    const playerAlive = getAliveLetters(playerTeam).length;
    const aiAlive = getAliveLetters(aiTeam).length;
    if (playerAlive === 0 && aiAlive > 0) {
      resultEl.textContent = "AI wins!";
      setTimeout(() => {
        createTeamFromWord(playerTeam, "");
        resetStage(currentAIWord, "");
        resultEl.textContent = "Enter a word that matches the length";
        input.disabled = false;
        input.value = "";
        input.setAttribute("maxlength", currentAIWord.length);
      }, 1000);
    } else if (aiAlive === 0 && playerAlive > 0) {
      resultEl.textContent = "Player wins!";
      setTimeout(() => {
        startNewRound();
      }, 1000);
    } else {
      resultEl.textContent = "Draw!";
      setTimeout(() => {
        startNewRound();
      }, 1000);
    }
  });
});
</script>
</body>
</html>
